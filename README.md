# KGQA-people_relation

基于知识图谱模板匹配的桃园三结义人物关系问答系统

数据来源：[老刘说NLP作者的一个仓库中的人物关系数据集](https://github.com/liuhuanyong/PersonRelationKnowledgeGraph/blob/master/EventMonitor/rel_data.txt)

TODO

---

- [X]  找数据、处理数据 -21\12\23
- [X]  构建知识图谱 -21\12\24
- [X]  定义关系问题，构建模板 -21\12\24
- [X]  编写问答脚本 -21\12\24
- [X]  重构，添加一点问题，完善问答的鲁棒性 -21\12\25

环境：

```bash
pandas==1.2.4
py2neo==2021.2.3

neo4j版本：4.4.0
jdk版本:11.0.13
```

图谱展示(安装好环境后可以根据图谱内容进行提问)：

![graph.png](./output/graph.png)

问题模板展示(目前能回答这两种问题):


| question                 | cypher                                                           | answer | check                 |
| -------------------------- | ------------------------------------------------------------------ | -------- | ----------------------- |
| %ENT0%和%ENT1%是什么关系 | Match (n {NAME:"%ENT0%"})-[REL]->(m {NAME:"%ENT1%"}) return REL  | REL    | {"%ENT%":2,"%REL%":0} |
| %ENT0%的%REL0%是谁       | MATCH (n:人)-[:%REL0%]->(m:人) WHERE n.NAME = "%ENT0%" RETURN m | m      | {"%ENT%":1,"%REL%":1} |

## 1.下载

`git clone git@github.com:eat-or-eat/KGQA-people_relation.git`

## 2.（可选）添加自己的数据

将数据处理成`/data/rel_data.txt`的txt格式进行替换（实体###关系###实体）

```bash
eg:
三毛###贾平凹###好友
袁买###袁熙###哥哥
。。。

```

`

## 3.运行

1. 建图

`python build_graph.py`

打印展示:

```bash
清图耗时: 0.01564311981201172
建图耗时: 0.015603780746459961
共执行82条cypher语句
```

2. 问答

`python qa_by_template_match.py`

问答效果展示：

```bash
        桃园三结义人物关系知识图谱加载完毕！
        可以查询桃园三结义的相关人物关系~
  
-------------------------------
测试用例
问题:刘备和张飞什么关系:
回答:刘备的三弟是张飞
-------------------------------
测试用例
问题:张飞和刘备什么关系:
回答:刘备的三弟是张飞
-------------------------------
测试用例
问题:刘备和关羽什么关系:
回答:刘备的二弟是关羽 关羽的大哥是刘备
-------------------------------
测试用例
问题:刘备和张辽什么关系:
回答:对不起，没有合适的答案
-------------------------------
测试用例
问题:特朗普和拜登什么关系:
回答:对不起，没有合适的答案
-------------------------------
测试用例
问题:刘备的三弟是谁:
回答:刘备的三弟是张飞
-------------------------------
测试用例
问题:谁是黄忠的主公:
回答:黄忠的主公是刘备
-------------------------------
测试用例
问题:特朗普的儿子是谁:
回答:对不起，没有合适的答案
-------------------------------
请输入您想问的问题：>? 关羽的弟弟是谁
回答:关羽的弟弟是张飞
-------------------------------
请输入您想问的问题：>? 张飞和张遵什么关系
回答:张飞的孙子是张遵 张遵的祖父是张飞
-------------------------------
```

# 二，项目介绍

```bash
│  build_graph.py  # 建表脚本
│  config.py  # 配置文件
│  qa_by_template_match.py  # 问答接口脚本
│  README.md
│  requirements.txt
│
├─cyphermark
│      README.md  # 一点用到的cypher语句记录
│
├─data
│      rel_data.txt  # 原始的老刘说NLP作者github仓库的数据
│      triplet_data.txt  # 处理后的桃园三结义人物关系数据
│
├─output
│      graph.png  # 图谱截图
│      kg_data.json  # 图谱节点记录
│      template.xlsx  # 模板（目前能回答两种问题）
│
├─src
│  │  answer.py  # 回答问题的类，方便添加和删除
│  │  builder.py  # 建表的类
│  │  loader.py  # 载入图谱节点数据
│  │  model.py  # 规则|简单算法模型
│  │  prepare_data.py  # 数据预处理脚本
```
